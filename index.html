<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® ë‹¤ë¹ˆì¹˜ ì½”ë“œ ê²Œì„</title>
    <style>
        @import url('style.css');
    </style>
</head>
<body>
    <!-- ê²Œì„ í™”ë©´ -->
    <div id="gameScreen" class="screen active">
        <header>
            <div class="header-content">
                <div class="game-title">ğŸ® ë‹¤ë¹ˆì¹˜ ì½”ë“œ</div>
                <div class="game-info">
                    <div class="info-item">
                        <span class="info-label">í„´:</span>
                        <span class="info-value" id="turnCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ë§ì¶˜ ì¹´ë“œ:</span>
                        <span class="info-value" id="correctCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ê°€ëŠ¥í•œ ë±:</span>
                        <span class="info-value" id="possibleDecks">-</span>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="initGame()">ğŸ² ìƒˆ ê²Œì„</button>
                    <button onclick="showRankingScreen()">ğŸ† ë­í‚¹</button>
                    <button onclick="testGenerateDeck()" id="testDeckBtn" disabled>ğŸ” ë¶„ì„</button>
                    <button onclick="logout()" id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <div class="player-welcome" id="playerWelcome" aria-live="polite"></div>
            </div>
        </header>

        <div class="game-container">
            <div class="opponent-area">
                <div class="opponent-label">
                    <span>ğŸ¤–</span>
                    <span>AIì˜ ì¹´ë“œ</span>
                </div>
                <div class="opponent-deck" id="opponentDeck"></div>
            </div>

            <div class="center-area">
                <div class="turn-indicator" id="turnIndicator">ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”</div>
            </div>

            <div class="player-area">
                <div class="action-area">
                    <button class="action-btn btn-pass" onclick="passTurn()" id="passBtn" disabled>
                        â­ï¸ í„´ ë„˜ê¸°ê¸°
                    </button>
                </div>
                <div class="player-label">
                    <span>ğŸ‘¤</span>
                    <span>ë‚´ ì¹´ë“œ</span>
                </div>
                <div class="player-deck" id="playerDeck"></div>
            </div>
        </div>
    </div>

    <!-- ë­í‚¹ í™”ë©´ -->
    <div id="rankingScreen" class="screen">
        <header>
            <div class="header-content">
                <div class="game-title">ğŸ† ë­í‚¹</div>
                <div class="controls">
                    <button onclick="showGameScreen()">ğŸ® ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            </div>
        </header>

        <div class="ranking-container">
            <div class="ranking-header">
                <h1>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h1>
            </div>

            <div class="ranking-stats">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘‘</div>
                    <div class="stat-label">1ìœ„</div>
                    <div class="stat-value" id="topPlayer">-</div>
                    <div class="stat-sub" id="topTurns">- í„´</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-label">ì´ ê²Œì„ ìˆ˜</div>
                    <div class="stat-value" id="totalGames">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">âš¡</div>
                    <div class="stat-label">í‰ê·  í„´</div>
                    <div class="stat-value" id="avgTurns">-</div>
                </div>
            </div>

            <div class="ranking-table-wrapper">
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th width="80">ìˆœìœ„</th>
                            <th>ë‹‰ë„¤ì„</th>
                            <th width="100">í„´ ìˆ˜</th>
                            <th width="120">ë‚ ì§œ</th>
                        </tr>
                    </thead>
                    <tbody id="rankingTableBody">
                        <tr>
                            <td colspan="4" style="text-align:center; padding:40px;">
                                ì•„ì§ ë­í‚¹ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- <div class="ranking-footer">
                <button class="clear-ranking-btn" onclick="clearRankings()">ğŸ—‘ï¸ ë­í‚¹ ì´ˆê¸°í™”</button>
            </div> -->
        </div>
    </div>

    <!-- ê¸°ì¡´ ëª¨ë‹¬ë“¤ -->
    <div class="joker-placement-modal" id="jokerModal">
        <div class="joker-modal-content">
            <h3>ğŸƒ ì¡°ì»¤ë¥¼ ë°°ì¹˜í•  ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
            <div class="position-grid" id="positionGrid"></div>
        </div>
    </div>

    <div class="number-selection-modal" id="numberModal">
        <div class="number-modal-content">
            <div class="number-selector" id="numberSelector">
                <h3>ì˜ˆì¸¡í•  ìˆ«ìë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
                <div class="number-grid" id="numberGrid"></div>
                <div class="joker-button-container">
                    <button class="joker-btn" id="jokerBtn">ğŸƒ ì¡°ì»¤</button>
                </div>
                <button class="cancel-btn" onclick="cancelSelection()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <div class="game-over-modal" id="gameOverModal">
        <div class="modal-content">
            <div class="winner-icon" id="winnerIcon"></div>
            <h2 id="winnerText"></h2>
            <p id="winnerMessage"></p>
            <button onclick="closeModal()" style="padding: 15px 50px; font-size: 1.2em;">í™•ì¸</button>
        </div>
    </div>

    <div class="toast" id="toast"></div>
    <div class="toast-log" id="toastLog" aria-live="polite"></div>

    <div id="loginModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-box">
            <div class="login-box">
                <h2>ë¡œê·¸ì¸</h2>
                <p>ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë©´ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div class="input-row">
                    <input id="studentNumberInput" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="í•™ë²ˆ (ì˜ˆ: 10101)" aria-label="í•™ë²ˆ ì…ë ¥" />
                </div>
                <div class="input-row">
                    <input id="nameInput" type="text" placeholder="ì´ë¦„" autocomplete="name" aria-label="ì´ë¦„ ì…ë ¥" />
                </div>
                <div class="input-row">
                    <input id="nicknameInput" type="text" placeholder="ë­í‚¹ì— í‘œì‹œë  ë‹‰ë„¤ì„" aria-label="ë‹‰ë„¤ì„ ì…ë ¥" />
                </div>
                <div class="login-actions">
                    <button id="loginButton">ë¡œê·¸ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } 
            from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCtvxpEpR15gr2CRoH_Gjk6AAA3EiXzNGU",
            authDomain: "davincicode-770b9.firebaseapp.com",
            projectId: "davincicode-770b9",
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ì „ì—­ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        window.firebaseApp = app;
        window.db = db;
        window.firebaseModules = {
            collection,
            addDoc,
            query,
            orderBy,
            limit,
            getDocs
        };

        console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ');

        // Firebase ì´ˆê¸°í™” í›„ game.js ë¡œë“œ
        const script = document.createElement('script');
        script.src = 'game.js';
        document.body.appendChild(script);
    </script>
</body>
</html>